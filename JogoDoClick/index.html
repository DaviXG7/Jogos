<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../boostrap/bootstrap.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<img class="fundo" src="https://img.freepik.com/fotos-gratis/papel-de-parede-padrao-de-fundo-abstrato-grunge-preto-com-foto-gratis_1340-33834.jpg" alt="">
<form class="caixa principal" id="inicio" style="display: flex">
    <img src="imgs/whack.png" alt="" style="max-height: 100px; border-radius: 20px">
    <h3>Whack a Mole :D</h3>
    <div class="d-flex">
        <p class="m-1" id="cS">Sorrisos capturados: </p>
    </div>
    <select required id="dificuldade" class="form-select" aria-label="Default select example">
        <option value="0" selected>Selecione a dificuldade</option>
        <option value="1">Fácil (2s)</option>
        <option value="2">Médio (1s)</option>
        <option value="3">Difícil (0.5s)</option>
        <option value="4">Personalizado</option>
    </select>
    <div class="input-group d-none" id="persdif">
        <input type="text" id="ipdif" class="form-control" placeholder="Digite os segundos" aria-label="Username" aria-describedby="basic-addon1">
    </div>
    <select required id="tamanho" class="form-select" aria-label="Default select example">
        <option value="0" selected>Selecione o tamanho da malha</option>
        <option value="1">3x3</option>
        <option value="2">5x5</option>
        <option value="3">10x10</option>
        <option value="4">Personalizado</option>
    </select>
    <div id="persm" class="input-group d-none">
        <input type="text" id="ipm" class="form-control" placeholder="Digite o lado da malha (max.: 10)" aria-label="Username" aria-describedby="basic-addon1">
    </div>

    <button class="btn btn-outline-primary" type="submit">Começar o jogo</button>

    <small style="font-size: 11px; text-align: center">Feito por DaviXG7</small>
    <small id="error" style="color: red; font-size: 11px; text-align: center"></small>
</form>
<br>
<div class="caixa jogo d-none" id="jogo" style="">
    <div id="malha" class="malha bg-dark"></div>
    <p>Sorrisos capturados</p>
    <button id="parar" class="btn btn-outline-danger">Parar jogo</button>
    <div id="acabou" style="display: none !important;" class="d-flex w-100">
        <button id="jogarDeNovo" class="d-none btn m-1 btn-success" onclick="comecarJogo(jogo.type)">Jogar Novamente</button>
        <button id="voltar" class="d-none btn m-1 btn-warning">Voltar ao início</button>
    </div>
</div>
<script src="../js/jQuery.js"></script>
<script>

    let sorrisos = 0;

    let jogo = {
        isRunning: false,
        segundos: 0,
        malha: []
    }

    function atualizarV() {
        document.getElementById("cS").textContent = "Sorrisos capturados: " + sorrisos;
    }

    $("#inicio").submit(function (event) {

        event.preventDefault();

        let dificuldade = $("#dificuldade");
        let tamanho = $("#tamanho");

        if (dificuldade.val() === "0" || tamanho.val() === "0") {
            document.getElementById("error").textContent = "Selecione pelo menos uma opção dos dois seletores!";
            return;
        }

        if ((dificuldade.val() === "4" && $("#ipdif").val() === "") && (dificuldade.val() === "4" && $("#ipm").val() === "")) {
            document.getElementById("error").textContent = "Preencha o campo personalizado!";
            return;
        }

        switch (dificuldade.val()) {
            case "1":
                jogo.segundos = 2;
                break;
            case "2":
                jogo.segundos = 1;
                break
            case "3":
                jogo.segundos = 0.5;
                break;
            case "4":
                jogo.segundos = parseFloat($("#ipdif").val())
                break;
            default:
                document.getElementById("error").textContent = "Coloque um número nos campos personalizados";
                return;
        }


        switch (tamanho.val()) {
            case "1":
                for (let i = 0; i < 3**2; i++) {
                    jogo.malha.push("");
                    console.log(i)
                    const span = document.createElement('span');
                    span.id = i + "";
                    document.getElementById("malha").appendChild(span);
                }
                break;
            case "2":
                for (let i = 0; i < 5**2; i++) {
                    jogo.malha.push("");
                    const span = document.createElement('span');
                    span.id = i + "";
                    document.getElementById("malha").appendChild(span);
                }
                break
            case "3":
                for (let i = 0; i < 10**2; i++) {
                    jogo.malha.push("");
                    const span = document.createElement('span');
                    span.id = i + "";
                    document.getElementById("malha").appendChild(span);
                }
                break;
            case "4":
                let tam = parseInt($("#ipm").val())
                if (tam <= 0) {
                    document.getElementById("error").textContent = "Coloque um número natural nos campos personalizados";
                    return;
                }
                for (let i = 0; i < tam**2; i++) {
                    jogo.malha.push("");
                    const span = document.createElement('span');
                    span.id = i + "";
                    document.getElementById("malha").appendChild(span);
                }
                break;
        }


        const malha = document.getElementById('malha');
        const spans = document.querySelectorAll('span');
        const totalSquares = spans.length;

        const gridSize = Math.sqrt(totalSquares);
        malha.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
        malha.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;

        document.getElementById("error").textContent = "";
        document.getElementById("inicio").classList.add("d-none")
        document.getElementById("jogo").classList.remove("d-none")

        jogo.isRunning = true;
        rodar();


    })

    $("#dificuldade").on("change", function (event) {
        if (this.value === "4") {
            $("#persdif").removeClass("d-none");
            return;
        }
        $("#persdif").addClass("d-none");
    })
    $("#tamanho").on("change", function (event) {
        if (this.value === "4") {
            $("#persm").removeClass("d-none");
            return;
        }
        $("#persm").addClass("d-none");
    })

    let randomAgora = 0

    function rodar() {

            setTimeout( function () {
                if (!jogo.isRunning) return;

                jogo.malha[randomAgora] = ""
                document.getElementById("malha").children[randomAgora].textContent = ""
                document.getElementById("malha").children[randomAgora].classList.remove("span-bixo")

                let random = Math.random() * 100
                if (random <= 40) {
                    randomAgora = Math.floor(Math.random() * jogo.malha.length) - 1;
                    jogo.malha[randomAgora] = ":D"
                    document.getElementById("malha").children[randomAgora].classList.add("span-bixo")
                    document.getElementById("malha").children[randomAgora].textContent = ":D"
                }

                rodar();
            }, jogo.segundos * 1000)
    }

    $('#malha').children().each( function (event) {

        let child = this;

        $(child).on("click", function (event) {

            console.log(child.id)

            if (jogo.malha[parseInt(child.id)] !== "") {
                sorrisos++;
                atualizarV();
            }
        })
    })

    atualizarV();
</script>

</body>
</html>